import{_ as t,c as p,a,d as e,e as l,f as o,r,o as c,b as i}from"./app-BCC5ysrj.js";const d={},u={class:"vuepress-toc"},v={class:"vuepress-toc-item"},m={class:"vuepress-toc-item"},h={class:"vuepress-toc-item"},b={class:"vuepress-toc-item"},k={class:"vuepress-toc-item"},g={class:"vuepress-toc-item"},f={class:"vuepress-toc-item"};function _(I,s){const n=r("router-link");return c(),p("div",null,[s[7]||(s[7]=a("h1",{id:"history配置",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#history配置"},[a("span",null,"history配置")])],-1)),a("nav",u,[a("ul",null,[a("li",v,[e(n,{to:"#简介"},{default:l(()=>s[0]||(s[0]=[i("简介")])),_:1})]),a("li",m,[e(n,{to:"#配置文件说明"},{default:l(()=>s[1]||(s[1]=[i("配置文件说明")])),_:1}),a("ul",null,[a("li",h,[e(n,{to:"#环境变量文件"},{default:l(()=>s[2]||(s[2]=[i("环境变量文件")])),_:1})])])]),a("li",b,[e(n,{to:"#配置方法"},{default:l(()=>s[3]||(s[3]=[i("配置方法")])),_:1}),a("ul",null,[a("li",k,[e(n,{to:"#方法一-配置全局变量"},{default:l(()=>s[4]||(s[4]=[i("方法一：配置全局变量")])),_:1})]),a("li",g,[e(n,{to:"#方法二-使用脚本配置"},{default:l(()=>s[5]||(s[5]=[i("方法二：使用脚本配置")])),_:1})])])]),a("li",f,[e(n,{to:"#最佳实践"},{default:l(()=>s[6]||(s[6]=[i("最佳实践")])),_:1})])])]),s[8]||(s[8]=o(`<hr><h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介"><span>简介</span></a></h2><p>history 命令用于记录用户执行过的命令。在生产环境中，记录命令执行的详细信息（如时间、用户等）对于系统审计和问题排查非常重要。</p><h2 id="配置文件说明" tabindex="-1"><a class="header-anchor" href="#配置文件说明"><span>配置文件说明</span></a></h2><h3 id="环境变量文件" tabindex="-1"><a class="header-anchor" href="#环境变量文件"><span>环境变量文件</span></a></h3><ul><li><p>用户级配置：</p><ul><li><code>~/.bashrc</code></li><li><code>~/.bash_profile</code></li></ul></li><li><p>系统级配置：</p><ul><li><code>/etc/profile</code></li><li><code>/etc/bashrc</code></li><li><code>/etc/profile.d/*.sh</code></li></ul></li></ul><h2 id="配置方法" tabindex="-1"><a class="header-anchor" href="#配置方法"><span>配置方法</span></a></h2><h3 id="方法一-配置全局变量" tabindex="-1"><a class="header-anchor" href="#方法一-配置全局变量"><span>方法一：配置全局变量</span></a></h3><h4 id="_1-记录命令执行时间" tabindex="-1"><a class="header-anchor" href="#_1-记录命令执行时间"><span>1. 记录命令执行时间</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 编辑全局配置</span></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/bashrc <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="line"></span>
<span class="line"># 设置时间格式</span>
<span class="line">export HISTTIMEFORMAT=&quot;[%Y-%m-%d %H:%M:%S] <span class="token variable"><span class="token variable">\`</span><span class="token function">whoami</span><span class="token variable">\`</span></span>: &quot;</span>
<span class="line">EOF</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-设置历史记录大小" tabindex="-1"><a class="header-anchor" href="#_2-设置历史记录大小"><span>2. 设置历史记录大小</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 设置内存中的历史命令数量</span></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/bashrc <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="line">export HISTSIZE=10000</span>
<span class="line"></span>
<span class="line"># 设置历史文件大小</span>
<span class="line">export HISTFILESIZE=10000</span>
<span class="line">EOF</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-配置历史文件" tabindex="-1"><a class="header-anchor" href="#_3-配置历史文件"><span>3. 配置历史文件</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 编辑用户配置</span></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /root/.bashrc <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="line"></span>
<span class="line"># 指定历史文件位置</span>
<span class="line">export HISTFILE=/root/.bash_history</span>
<span class="line"></span>
<span class="line"># 启用追加模式</span>
<span class="line">shopt -s histappend</span>
<span class="line">EOF</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-历史记录控制" tabindex="-1"><a class="header-anchor" href="#_4-历史记录控制"><span>4. 历史记录控制</span></a></h4><ul><li>HISTCONTROL <ul><li>ignoredups：忽略连续重复命令</li><li>ignorespace：忽略空格开头的命令</li><li>ignoreboth：同时启用上述两种</li><li>erasedups：忽略所有重复命令</li></ul></li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/profile <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="line"># 设置历史记录控制</span>
<span class="line">export HISTCONTROL=ignoredups   # 忽略连续重复命令</span>
<span class="line">EOF</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-实时记录" tabindex="-1"><a class="header-anchor" href="#_5-实时记录"><span>5. 实时记录</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/bashrc <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="line"># 启用实时记录</span>
<span class="line">export PROMPT_COMMAND=&#39;history -a&#39;</span>
<span class="line">EOF</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="方法二-使用脚本配置" tabindex="-1"><a class="header-anchor" href="#方法二-使用脚本配置"><span>方法二：使用脚本配置</span></a></h3><p>创建配置脚本 <code>/etc/profile.d/history_config.sh</code>：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置历史记录目录</span></span>
<span class="line"><span class="token assign-left variable">HISTDIR</span><span class="token operator">=</span>/usr/share/.history</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取用户 IP</span></span>
<span class="line"><span class="token assign-left variable">USER_IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">who</span> <span class="token parameter variable">-u</span> am i <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $NF}&#39;</span><span class="token operator">|</span><span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;s/[()]//g&#39;</span><span class="token variable">\`</span></span></span>
<span class="line"><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$USER_IP</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">USER_IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">hostname</span><span class="token variable">\`</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建历史记录目录</span></span>
<span class="line"><span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token string">&quot;<span class="token variable">$HISTDIR</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;<span class="token variable">$HISTDIR</span>&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> <span class="token number">777</span> <span class="token string">&quot;<span class="token variable">$HISTDIR</span>&quot;</span></span>
<span class="line"><span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token string">&quot;<span class="token variable">$HISTDIR</span>/<span class="token variable">\${<span class="token environment constant">LOGNAME</span>}</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;<span class="token variable">$HISTDIR</span>/<span class="token variable">\${<span class="token environment constant">LOGNAME</span>}</span>&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> <span class="token number">300</span> <span class="token string">&quot;<span class="token variable">$HISTDIR</span>/<span class="token variable">\${<span class="token environment constant">LOGNAME</span>}</span>&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 配置历史记录</span></span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">HISTSIZE</span></span><span class="token operator">=</span><span class="token number">4000</span></span>
<span class="line"><span class="token assign-left variable">DT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">date</span> +%Y-%m-%d_%H:%M:%S<span class="token variable">\`</span></span></span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">HISTFILE</span></span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$HISTDIR</span>/<span class="token variable">\${<span class="token environment constant">LOGNAME</span>}</span>/<span class="token variable">\${USER_IP}</span>.history.<span class="token variable">$DT</span>&quot;</span></span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">HISTTIMEFORMAT</span><span class="token operator">=</span><span class="token string">&quot;[%F %T] <span class="token variable">\${USER_IP}</span>: &quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置权限</span></span>
<span class="line"><span class="token function">chmod</span> <span class="token number">600</span> <span class="token variable">$HISTDIR</span>/<span class="token variable">\${<span class="token environment constant">LOGNAME</span>}</span>/*.history* <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="最佳实践" tabindex="-1"><a class="header-anchor" href="#最佳实践"><span>最佳实践</span></a></h2><ol><li><p><strong>配置建议</strong></p><ul><li>根据实际需求选择配置方式</li><li>合理设置历史记录大小</li><li>定期清理历史文件</li></ul></li><li><p><strong>安全建议</strong></p><ul><li>限制历史文件访问权限</li><li>记录关键命令执行信息</li><li>定期备份历史记录</li></ul></li></ol><blockquote><p><strong>注意：</strong></p><ul><li>修改配置后需要 source 生效</li><li>注意历史文件的权限设置</li><li>合理规划存储空间</li></ul></blockquote><hr><blockquote><p><strong>参考资料：</strong></p><ul><li><a href="https://www.gnu.org/software/bash/manual/html_node/Bash-History-Facilities.html" target="_blank" rel="noopener noreferrer">Bash History 文档</a></li><li><a href="https://linux-audit.com/" target="_blank" rel="noopener noreferrer">Linux 系统审计</a></li></ul></blockquote>`,27))])}const S=t(d,[["render",_],["__file","history.html.vue"]]),T=JSON.parse('{"path":"/flinux/Commands/history.html","title":"history配置","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"简介","slug":"简介","link":"#简介","children":[]},{"level":2,"title":"配置文件说明","slug":"配置文件说明","link":"#配置文件说明","children":[{"level":3,"title":"环境变量文件","slug":"环境变量文件","link":"#环境变量文件","children":[]}]},{"level":2,"title":"配置方法","slug":"配置方法","link":"#配置方法","children":[{"level":3,"title":"方法一：配置全局变量","slug":"方法一-配置全局变量","link":"#方法一-配置全局变量","children":[]},{"level":3,"title":"方法二：使用脚本配置","slug":"方法二-使用脚本配置","link":"#方法二-使用脚本配置","children":[]}]},{"level":2,"title":"最佳实践","slug":"最佳实践","link":"#最佳实践","children":[]}],"git":{"updatedTime":1735019797000,"contributors":[{"name":"Linkefou","username":"Linkefou","email":"wlh724567296@163.com","commits":1},{"name":"wanglinhao","username":"wanglinhao","email":"wanglinhao@wegooooo.com","commits":2}]},"filePathRelative":"flinux/Commands/history.md"}');export{S as comp,T as data};
