import{_ as i,c as p,a as n,d as t,e,f as r,r as c,o as d,b as l}from"./app-BCC5ysrj.js";const o={},u={class:"vuepress-toc"},v={class:"vuepress-toc-item"},m={class:"vuepress-toc-item"},k={class:"vuepress-toc-item"},h={class:"vuepress-toc-item"},b={class:"vuepress-toc-item"},y={class:"vuepress-toc-item"},f={class:"vuepress-toc-item"};function x(g,s){const a=c("router-link");return d(),p("div",null,[s[7]||(s[7]=n("h1",{id:"系统服务启动文件",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#系统服务启动文件"},[n("span",null,"系统服务启动文件")])],-1)),n("nav",u,[n("ul",null,[n("li",v,[t(a,{to:"#服务文件详解"},{default:e(()=>s[0]||(s[0]=[l("服务文件详解")])),_:1}),n("ul",null,[n("li",m,[t(a,{to:"#文件位置"},{default:e(()=>s[1]||(s[1]=[l("文件位置")])),_:1})]),n("li",k,[t(a,{to:"#配置文件结构"},{default:e(()=>s[2]||(s[2]=[l("配置文件结构")])),_:1})]),n("li",h,[t(a,{to:"#unit部分"},{default:e(()=>s[3]||(s[3]=[l("Unit部分")])),_:1})]),n("li",b,[t(a,{to:"#service部分"},{default:e(()=>s[4]||(s[4]=[l("Service部分")])),_:1})]),n("li",y,[t(a,{to:"#install部分"},{default:e(()=>s[5]||(s[5]=[l("Install部分")])),_:1})])])]),n("li",f,[t(a,{to:"#完整示例"},{default:e(()=>s[6]||(s[6]=[l("完整示例")])),_:1})])])]),s[8]||(s[8]=r(`<hr><h2 id="服务文件详解" tabindex="-1"><a class="header-anchor" href="#服务文件详解"><span>服务文件详解</span></a></h2><h3 id="文件位置" tabindex="-1"><a class="header-anchor" href="#文件位置"><span>文件位置</span></a></h3><ul><li>系统服务目录: <code>/usr/lib/systemd/system/xxx.service</code></li><li>用户服务目录: <code>/etc/systemd/system/xxx.service</code></li></ul><h3 id="配置文件结构" tabindex="-1"><a class="header-anchor" href="#配置文件结构"><span>配置文件结构</span></a></h3><p>服务文件由三个主要部分组成:</p><ol><li><p><strong>[Unit]</strong> 部分</p><ul><li>定义服务的描述、依赖和顺序</li></ul></li><li><p><strong>[Service]</strong> 部分</p><ul><li>定义服务的具体行为</li></ul></li><li><p><strong>[Install]</strong> 部分</p><ul><li>定义服务的启用/禁用配置</li></ul></li></ol><h3 id="unit部分" tabindex="-1"><a class="header-anchor" href="#unit部分"><span>Unit部分</span></a></h3><p>常用选项：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>Description</td><td>服务描述信息</td></tr><tr><td>After</td><td>在指定服务之后启动</td></tr><tr><td>Before</td><td>在指定服务之前启动</td></tr><tr><td>Requires</td><td>强依赖关系，依赖服务必须启动</td></tr><tr><td>Wants</td><td>弱依赖关系，依赖服务启动失败不影响本服务</td></tr><tr><td>Conflicts</td><td>冲突服务，不能同时运行</td></tr><tr><td>Documentation</td><td>文档地址</td></tr><tr><td>Condition*</td><td>启动条件</td></tr></tbody></table><h3 id="service部分" tabindex="-1"><a class="header-anchor" href="#service部分"><span>Service部分</span></a></h3><p>常用选项：</p><h4 id="type-类型" tabindex="-1"><a class="header-anchor" href="#type-类型"><span>Type 类型</span></a></h4><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>simple</td><td>默认类型，主进程由 ExecStart 启动</td></tr><tr><td>forking</td><td>服务会调用 fork() 创建子进程</td></tr><tr><td>oneshot</td><td>一次性执行，执行完就退出</td></tr><tr><td>dbus</td><td>通过 D-Bus 启动</td></tr><tr><td>notify</td><td>启动完成后发送通知</td></tr><tr><td>idle</td><td>等待其他任务完成后才启动</td></tr></tbody></table><h4 id="进程控制" tabindex="-1"><a class="header-anchor" href="#进程控制"><span>进程控制</span></a></h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>User</td><td>运行服务的用户</td></tr><tr><td>Group</td><td>运行服务的用户组</td></tr><tr><td>WorkingDirectory</td><td>工作目录</td></tr><tr><td>RootDirectory</td><td>根目录</td></tr><tr><td>Nice</td><td>进程优先级</td></tr><tr><td>OOMScoreAdjust</td><td>OOM优先级</td></tr></tbody></table><h4 id="执行相关" tabindex="-1"><a class="header-anchor" href="#执行相关"><span>执行相关</span></a></h4><div class="language-ini line-numbers-mode" data-highlighter="prismjs" data-ext="ini" data-title="ini"><pre><code><span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span></span>
<span class="line"><span class="token comment"># 环境配置文件</span></span>
<span class="line"><span class="token key attr-name">EnvironmentFile</span><span class="token punctuation">=</span><span class="token value attr-value">/etc/sysconfig/myapp</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动命令</span></span>
<span class="line"><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/myapp</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动前执行</span></span>
<span class="line"><span class="token key attr-name">ExecStartPre</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/pre-start.sh</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动后执行</span></span>
<span class="line"><span class="token key attr-name">ExecStartPost</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/post-start.sh</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 停止命令</span></span>
<span class="line"><span class="token key attr-name">ExecStop</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/stop.sh</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 服务异常退出时自动重启</span></span>
<span class="line"><span class="token key attr-name">Restart</span><span class="token punctuation">=</span><span class="token value attr-value">always</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 重启间隔</span></span>
<span class="line"><span class="token key attr-name">RestartSec</span><span class="token punctuation">=</span><span class="token value attr-value">30</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="特殊标记说明" tabindex="-1"><a class="header-anchor" href="#特殊标记说明"><span>特殊标记说明</span></a></h4><p>ExecStart 命令前的特殊标记:</p><table><thead><tr><th>标记</th><th>说明</th></tr></thead><tbody><tr><td>@</td><td>参数作为一个整体传递</td></tr><tr><td>-</td><td>忽略命令失败</td></tr><tr><td>+</td><td>进程获得特权</td></tr></tbody></table><h3 id="install部分" tabindex="-1"><a class="header-anchor" href="#install部分"><span>Install部分</span></a></h3><p>常用选项：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>Alias</td><td>服务别名</td></tr><tr><td>RequiredBy</td><td>被其他服务强依赖</td></tr><tr><td>WantedBy</td><td>被其他服务弱依赖</td></tr><tr><td>Also</td><td>同时安装的其他服务</td></tr><tr><td>DefaultInstance</td><td>实例默认名称</td></tr></tbody></table><h2 id="完整示例" tabindex="-1"><a class="header-anchor" href="#完整示例"><span>完整示例</span></a></h2><div class="language-ini line-numbers-mode" data-highlighter="prismjs" data-ext="ini" data-title="ini"><pre><code><span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span></span>
<span class="line"><span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">My Application Service</span></span>
<span class="line"><span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network.target</span></span>
<span class="line"><span class="token key attr-name">Requires</span><span class="token punctuation">=</span><span class="token value attr-value">mysql.service</span></span>
<span class="line"><span class="token key attr-name">Documentation</span><span class="token punctuation">=</span><span class="token value attr-value">https://example.com/docs</span></span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span></span>
<span class="line"><span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">simple</span></span>
<span class="line"><span class="token key attr-name">User</span><span class="token punctuation">=</span><span class="token value attr-value">myapp</span></span>
<span class="line"><span class="token key attr-name">Group</span><span class="token punctuation">=</span><span class="token value attr-value">myapp</span></span>
<span class="line"><span class="token key attr-name">WorkingDirectory</span><span class="token punctuation">=</span><span class="token value attr-value">/opt/myapp</span></span>
<span class="line"><span class="token key attr-name">EnvironmentFile</span><span class="token punctuation">=</span><span class="token value attr-value">/etc/sysconfig/myapp</span></span>
<span class="line"><span class="token key attr-name">ExecStartPre</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/pre-start.sh</span></span>
<span class="line"><span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/myapp</span></span>
<span class="line"><span class="token key attr-name">ExecStop</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/stop.sh</span></span>
<span class="line"><span class="token key attr-name">Restart</span><span class="token punctuation">=</span><span class="token value attr-value">always</span></span>
<span class="line"><span class="token key attr-name">RestartSec</span><span class="token punctuation">=</span><span class="token value attr-value">30</span></span>
<span class="line"><span class="token key attr-name">Nice</span><span class="token punctuation">=</span><span class="token value attr-value">-5</span></span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span></span>
<span class="line"><span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span></span>
<span class="line"><span class="token key attr-name">Alias</span><span class="token punctuation">=</span><span class="token value attr-value">myapp.service</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>注意：</strong></p><ul><li><p>修改服务文件后需要重新加载:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">systemctl daemon-reload</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>路径必须使用绝对路径</p></li><li><p>Type=forking 时建议设置 PIDFile</p></li><li><p>注意设置合适的用户权限</p></li><li><p>建议添加文档链接</p></li></ul></blockquote>`,27))])}const S=i(o,[["render",x],["__file","Linux-系统服务启动文件.html.vue"]]),E=JSON.parse('{"path":"/flinux/Systemd/Linux-%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E6%96%87%E4%BB%B6.html","title":"系统服务启动文件","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"服务文件详解","slug":"服务文件详解","link":"#服务文件详解","children":[{"level":3,"title":"文件位置","slug":"文件位置","link":"#文件位置","children":[]},{"level":3,"title":"配置文件结构","slug":"配置文件结构","link":"#配置文件结构","children":[]},{"level":3,"title":"Unit部分","slug":"unit部分","link":"#unit部分","children":[]},{"level":3,"title":"Service部分","slug":"service部分","link":"#service部分","children":[]},{"level":3,"title":"Install部分","slug":"install部分","link":"#install部分","children":[]}]},{"level":2,"title":"完整示例","slug":"完整示例","link":"#完整示例","children":[]}],"git":{"updatedTime":1701020615000,"contributors":[{"name":"Linkefou","username":"Linkefou","email":"wlh724567296@163.com","commits":1}]},"filePathRelative":"flinux/Systemd/Linux-系统服务启动文件.md"}');export{S as comp,E as data};
