import{_ as i,c as l,a as s,b as a,d as t,e as p,f as o,r as c,o as u}from"./app-BCC5ysrj.js";const r={},d={class:"vuepress-toc"},k={class:"vuepress-toc-item"},f={class:"vuepress-toc-item"},m={class:"vuepress-toc-item"},v={class:"vuepress-toc-item"},b={class:"vuepress-toc-item"};function h(g,n){const e=c("router-link");return u(),l("div",null,[n[5]||(n[5]=s("h1",{id:"difflib-比较序列并生成差异信息",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#difflib-比较序列并生成差异信息"},[s("span",null,[s("code",null,"difflib"),a("：比较序列并生成差异信息")])])],-1)),s("nav",d,[s("ul",null,[s("li",k,[t(e,{to:"#核心功能"},{default:p(()=>n[0]||(n[0]=[a("核心功能")])),_:1}),s("ul",null,[s("li",f,[t(e,{to:"#sequencematcher-类"},{default:p(()=>n[1]||(n[1]=[a("SequenceMatcher 类")])),_:1})]),s("li",m,[t(e,{to:"#unified-diff-函数"},{default:p(()=>n[2]||(n[2]=[a("unified_diff 函数")])),_:1})])])]),s("li",v,[t(e,{to:"#应用场景"},{default:p(()=>n[3]||(n[3]=[a("应用场景")])),_:1})]),s("li",b,[t(e,{to:"#案例-对比nginx配置文件差异"},{default:p(()=>n[4]||(n[4]=[a("案例：对比Nginx配置文件差异")])),_:1})])])]),n[6]||(n[6]=o(`<p>Python 的 <code>difflib</code> 模块提供了一组工具，用于比较序列并生成差异信息。它常用于文本比较、文件差异分析等场景。本文将详细介绍 <code>difflib</code> 模块的功能、用法及其应用场景。</p><h2 id="核心功能" tabindex="-1"><a class="header-anchor" href="#核心功能"><span>核心功能</span></a></h2><p><code>difflib</code> 模块的核心功能是比较两个序列（通常是字符串或列表），并生成它们之间的差异信息。主要工具包括 <code>SequenceMatcher</code> 类和 <code>unified_diff</code> 函数。</p><h3 id="sequencematcher-类" tabindex="-1"><a class="header-anchor" href="#sequencematcher-类"><span><code>SequenceMatcher</code> 类</span></a></h3><p><code>SequenceMatcher</code> 是 <code>difflib</code> 的核心类，用于比较两个序列并找出相似度。</p><h4 id="用法" tabindex="-1"><a class="header-anchor" href="#用法"><span>用法</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> difflib <span class="token keyword">import</span> SequenceMatcher</span>
<span class="line"></span>
<span class="line">seq1 <span class="token operator">=</span> <span class="token string">&quot;Python is great&quot;</span></span>
<span class="line">seq2 <span class="token operator">=</span> <span class="token string">&quot;Python is awesome&quot;</span></span>
<span class="line"></span>
<span class="line">matcher <span class="token operator">=</span> SequenceMatcher<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> seq1<span class="token punctuation">,</span> seq2<span class="token punctuation">)</span></span>
<span class="line">similarity_ratio <span class="token operator">=</span> matcher<span class="token punctuation">.</span>ratio<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;相似度: </span><span class="token interpolation"><span class="token punctuation">{</span>similarity_ratio<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="特点" tabindex="-1"><a class="header-anchor" href="#特点"><span>特点</span></a></h4><ul><li><code>ratio()</code> 方法返回两个序列的相似度，值在 0 到 1 之间。</li><li><code>get_opcodes()</code> 方法返回一个操作码列表，描述如何将第一个序列转换为第二个序列。</li></ul><h3 id="unified-diff-函数" tabindex="-1"><a class="header-anchor" href="#unified-diff-函数"><span><code>unified_diff</code> 函数</span></a></h3><p><code>unified_diff</code> 函数用于生成两个文本序列的统一格式差异</p><h4 id="用法-1" tabindex="-1"><a class="header-anchor" href="#用法-1"><span>用法</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> difflib <span class="token keyword">import</span> unified_diff</span>
<span class="line"></span>
<span class="line">text1 <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;Python is great.</span>
<span class="line">It is easy to learn.&quot;&quot;&quot;</span></span>
<span class="line">text2 <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;Python is awesome.</span>
<span class="line">It is easy to learn.&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line">diff <span class="token operator">=</span> unified_diff<span class="token punctuation">(</span>text1<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> text2<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lineterm<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;\\n&#39;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="特点-1" tabindex="-1"><a class="header-anchor" href="#特点-1"><span>特点</span></a></h4><ul><li>生成的差异信息以统一格式显示，类似于 <code>diff</code> 工具的输出。</li><li>可以指定文件名、行号等信息，便于追踪差异。</li></ul><h2 id="应用场景" tabindex="-1"><a class="header-anchor" href="#应用场景"><span>应用场景</span></a></h2><ul><li><strong>文本比较</strong>：用于比较两个文本文件的差异，如配置文件、代码文件。</li><li><strong>版本控制</strong>：用于生成文件的差异信息，便于版本管理。</li><li><strong>数据分析</strong>：用于比较数据集的差异，识别变化或异常。</li></ul><h2 id="案例-对比nginx配置文件差异" tabindex="-1"><a class="header-anchor" href="#案例-对比nginx配置文件差异"><span>案例：对比Nginx配置文件差异</span></a></h2><ul><li>维护多个Nginx配置，时常需要对比不同版本配置文件的差异。来了解不同版本迭代后的更新项</li><li>实现思路是读取两个需要对比的配置文件</li><li>在以换行符作为分隔符</li><li>调用difflib.HtmlDiff()生成 HTML 格式的差异文档</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># 实现案例的代码：</span></span>
<span class="line"><span class="token keyword">import</span> difflib</span>
<span class="line"><span class="token keyword">import</span> sys</span>
<span class="line"></span>
<span class="line"><span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">    textfile1 <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>                 <span class="token comment"># 第一个配置文件路径参数</span></span>
<span class="line">    textfile2 <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>                 <span class="token comment"># 第二个配置文件路径参数</span></span>
<span class="line"><span class="token keyword">except</span> Exception<span class="token punctuation">,</span>e<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Error:&quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Usage: simple3.py filename1 filename2&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line"><span class="token keyword">def</span> <span class="token function">readline</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>                     <span class="token comment"># 文件读取分隔函数</span></span>
<span class="line">    <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">        fileHandle <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token string">&#39;rb&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        text <span class="token operator">=</span> fileHandel<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token comment"># 读取后以行进行分隔</span></span>
<span class="line">        fileHandle<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> text</span>
<span class="line">    <span class="token keyword">except</span> IOError <span class="token keyword">as</span> error<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Read file Error:&#39;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line"><span class="token keyword">if</span> textfile<span class="token operator">==</span><span class="token string">&quot;&quot;</span> <span class="token keyword">or</span> textfile2<span class="token operator">==</span><span class="token string">&quot;&quot;</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Usage:simple3.py filename1 filename2&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">text1_lines <span class="token operator">=</span> readfile<span class="token punctuation">(</span>textfile1<span class="token punctuation">)</span>                   <span class="token comment"># 调用readfile函数，获取分割后的字符串</span></span>
<span class="line">text2_lines <span class="token operator">=</span> readfile<span class="token punctuation">(</span>textfile2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">d <span class="token operator">=</span> difflib<span class="token punctuation">.</span>HtmlDiff<span class="token punctuation">(</span><span class="token punctuation">)</span>                      <span class="token comment"># 创建HtmlDiff()类对象</span></span>
<span class="line"><span class="token keyword">print</span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span>make_file<span class="token punctuation">(</span>text1_lines<span class="token punctuation">,</span>text2_lines<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># 通过make_file方法输出HTML格式的比对结果</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,20))])}const x=i(r,[["render",h],["__file","library-difflib.html.vue"]]),q=JSON.parse('{"path":"/fpython/library/library/library-difflib.html","title":"difflib：比较序列并生成差异信息","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"核心功能","slug":"核心功能","link":"#核心功能","children":[{"level":3,"title":"SequenceMatcher 类","slug":"sequencematcher-类","link":"#sequencematcher-类","children":[]},{"level":3,"title":"unified_diff 函数","slug":"unified-diff-函数","link":"#unified-diff-函数","children":[]}]},{"level":2,"title":"应用场景","slug":"应用场景","link":"#应用场景","children":[]},{"level":2,"title":"案例：对比Nginx配置文件差异","slug":"案例-对比nginx配置文件差异","link":"#案例-对比nginx配置文件差异","children":[]}],"git":{"updatedTime":1735029308000,"contributors":[{"name":"wanglinhao","username":"wanglinhao","email":"wanglinhao@wegooooo.com","commits":2}]},"filePathRelative":"fpython/library/library/library-difflib.md"}');export{x as comp,q as data};
