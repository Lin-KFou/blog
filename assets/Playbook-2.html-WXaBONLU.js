import{_ as i,c as p,a as n,d as e,e as l,f as c,r as o,o as u,b as t}from"./app-BCC5ysrj.js";const r={},d={class:"vuepress-toc"},k={class:"vuepress-toc-item"},m={class:"vuepress-toc-item"},v={class:"vuepress-toc-item"},b={class:"vuepress-toc-item"},h={class:"vuepress-toc-item"},y={class:"vuepress-toc-item"},g={class:"vuepress-toc-item"},f={class:"vuepress-toc-item"},_={class:"vuepress-toc-item"},x={class:"vuepress-toc-item"},q={class:"vuepress-toc-item"},w={class:"vuepress-toc-item"},j={class:"vuepress-toc-item"},A={class:"vuepress-toc-item"},P={class:"vuepress-toc-item"},C={class:"vuepress-toc-item"},N={class:"vuepress-toc-item"},S={class:"vuepress-toc-item"},T={class:"vuepress-toc-item"};function O(R,s){const a=o("router-link");return u(),p("div",null,[s[19]||(s[19]=n("h1",{id:"playbook-操作",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#playbook-操作"},[n("span",null,"Playbook: 操作")])],-1)),n("nav",d,[n("ul",null,[n("li",k,[e(a,{to:"#条件语句"},{default:l(()=>s[0]||(s[0]=[t("条件语句")])),_:1}),n("ul",null,[n("li",m,[e(a,{to:"#单一条件"},{default:l(()=>s[1]||(s[1]=[t("单一条件")])),_:1})]),n("li",v,[e(a,{to:"#多重条件"},{default:l(()=>s[2]||(s[2]=[t("多重条件")])),_:1})]),n("li",b,[e(a,{to:"#注册变量条件"},{default:l(()=>s[3]||(s[3]=[t("注册变量条件")])),_:1})]),n("li",h,[e(a,{to:"#变量存在性检查"},{default:l(()=>s[4]||(s[4]=[t("变量存在性检查")])),_:1})])])]),n("li",y,[e(a,{to:"#循环语句"},{default:l(()=>s[5]||(s[5]=[t("循环语句")])),_:1}),n("ul",null,[n("li",g,[e(a,{to:"#基本循环"},{default:l(()=>s[6]||(s[6]=[t("基本循环")])),_:1})]),n("li",f,[e(a,{to:"#字典循环"},{default:l(()=>s[7]||(s[7]=[t("字典循环")])),_:1})]),n("li",_,[e(a,{to:"#文件匹配循环"},{default:l(()=>s[8]||(s[8]=[t("文件匹配循环")])),_:1})]),n("li",x,[e(a,{to:"#序列循环"},{default:l(()=>s[9]||(s[9]=[t("序列循环")])),_:1})])])]),n("li",q,[e(a,{to:"#错误处理"},{default:l(()=>s[10]||(s[10]=[t("错误处理")])),_:1}),n("ul",null,[n("li",w,[e(a,{to:"#忽略错误"},{default:l(()=>s[11]||(s[11]=[t("忽略错误")])),_:1})]),n("li",j,[e(a,{to:"#条件判断"},{default:l(()=>s[12]||(s[12]=[t("条件判断")])),_:1})]),n("li",A,[e(a,{to:"#块错误处理"},{default:l(()=>s[13]||(s[13]=[t("块错误处理")])),_:1})])])]),n("li",P,[e(a,{to:"#任务控制"},{default:l(()=>s[14]||(s[14]=[t("任务控制")])),_:1}),n("ul",null,[n("li",C,[e(a,{to:"#标签-tags"},{default:l(()=>s[15]||(s[15]=[t("标签(Tags)")])),_:1})]),n("li",N,[e(a,{to:"#任务委派"},{default:l(()=>s[16]||(s[16]=[t("任务委派")])),_:1})]),n("li",S,[e(a,{to:"#任务超时"},{default:l(()=>s[17]||(s[17]=[t("任务超时")])),_:1})])])]),n("li",T,[e(a,{to:"#最佳实践"},{default:l(()=>s[18]||(s[18]=[t("最佳实践")])),_:1})])])]),s[20]||(s[20]=c(`<hr><h2 id="条件语句" tabindex="-1"><a class="header-anchor" href="#条件语句"><span>条件语句</span></a></h2><p><code>when</code> 语句用于控制任务的执行条件。支持使用 Ansible facts、注册变量和自定义变量进行判断。</p><h3 id="单一条件" tabindex="-1"><a class="header-anchor" href="#单一条件"><span>单一条件</span></a></h3><p>使用单个条件判断:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装 Apache</span>
<span class="line">    <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=httpd state=present</span>
<span class="line">    <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_os_family == &quot;RedHat&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="多重条件" tabindex="-1"><a class="header-anchor" href="#多重条件"><span>多重条件</span></a></h3><p>支持使用多个条件组合:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># 使用 and 条件(隐式)</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 配置 CentOS 7 服务</span>
<span class="line">    <span class="token key atrule">template</span><span class="token punctuation">:</span> src=service.conf.j2 dest=/etc/service.conf</span>
<span class="line">    <span class="token key atrule">when</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ansible_distribution == &quot;CentOS&quot;</span>
<span class="line">      <span class="token punctuation">-</span> ansible_distribution_major_version == &quot;7&quot;</span>
<span class="line"></span>
<span class="line">  <span class="token comment"># 使用 or 条件</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装 RHEL 系包</span>
<span class="line">    <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=httpd state=present</span>
<span class="line">    <span class="token key atrule">when</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token scalar string"></span>
<span class="line">      ansible_distribution == &quot;CentOS&quot; or</span>
<span class="line">      ansible_distribution == &quot;RedHat&quot;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment"># 使用 not 条件</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 非 Debian 系统跳过</span>
<span class="line">    <span class="token key atrule">debug</span><span class="token punctuation">:</span> msg=&quot;不是 Debian&quot;</span>
<span class="line">    <span class="token key atrule">when</span><span class="token punctuation">:</span> not ansible_os_family == &quot;Debian&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="注册变量条件" tabindex="-1"><a class="header-anchor" href="#注册变量条件"><span>注册变量条件</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 检查服务状态</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> systemctl status httpd</span>
<span class="line">    <span class="token key atrule">register</span><span class="token punctuation">:</span> service_status</span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 重启服务</span>
<span class="line">    <span class="token key atrule">service</span><span class="token punctuation">:</span> name=httpd state=restarted</span>
<span class="line">    <span class="token key atrule">when</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> service_status.rc <span class="token tag">!=</span> 0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="变量存在性检查" tabindex="-1"><a class="header-anchor" href="#变量存在性检查"><span>变量存在性检查</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># 设置变量</span></span>
<span class="line"><span class="token key atrule">vars</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">db_password</span><span class="token punctuation">:</span> <span class="token string">&quot;your_secure_password&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 配置数据库              <span class="token comment"># 任务描述</span></span>
<span class="line">    <span class="token key atrule">template</span><span class="token punctuation">:</span>                     <span class="token comment"># 使用模板模块</span></span>
<span class="line">      <span class="token key atrule">src</span><span class="token punctuation">:</span> db.conf.j2            <span class="token comment"># 源模板文件</span></span>
<span class="line">      <span class="token key atrule">dest</span><span class="token punctuation">:</span> /etc/db.conf         <span class="token comment"># 目标配置文件</span></span>
<span class="line">    <span class="token key atrule">when</span><span class="token punctuation">:</span> db_password is defined  <span class="token comment"># 执行条件：db_password变量已定义</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="循环语句" tabindex="-1"><a class="header-anchor" href="#循环语句"><span>循环语句</span></a></h2><h3 id="基本循环" tabindex="-1"><a class="header-anchor" href="#基本循环"><span>基本循环</span></a></h3><p><code>with_items</code> 用于遍历列表项,常用于:</p><ul><li>批量安装软件包</li><li>创建多个用户/目录</li><li>复制多个文件</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装多个包</span>
<span class="line">    <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present</span>
<span class="line">    <span class="token key atrule">with_items</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> httpd</span>
<span class="line">      <span class="token punctuation">-</span> php</span>
<span class="line">      <span class="token punctuation">-</span> mysql<span class="token punctuation">-</span>server</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="字典循环" tabindex="-1"><a class="header-anchor" href="#字典循环"><span>字典循环</span></a></h3><p><code>with_dict</code> 用于遍历字典数据,可以:</p><ul><li>访问键值对</li><li>处理嵌套数据</li><li>配置复杂选项</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 创建用户</span>
<span class="line">    <span class="token key atrule">user</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;{{ item.key }}&quot;</span></span>
<span class="line">      <span class="token key atrule">groups</span><span class="token punctuation">:</span> <span class="token string">&quot;{{ item.value.groups }}&quot;</span></span>
<span class="line">      <span class="token key atrule">shell</span><span class="token punctuation">:</span> <span class="token string">&quot;{{ item.value.shell }}&quot;</span></span>
<span class="line">    <span class="token key atrule">with_dict</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">admin</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">groups</span><span class="token punctuation">:</span> wheel</span>
<span class="line">        <span class="token key atrule">shell</span><span class="token punctuation">:</span> /bin/bash</span>
<span class="line">      <span class="token key atrule">dev</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">groups</span><span class="token punctuation">:</span> developers</span>
<span class="line">        <span class="token key atrule">shell</span><span class="token punctuation">:</span> /bin/zsh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="文件匹配循环" tabindex="-1"><a class="header-anchor" href="#文件匹配循环"><span>文件匹配循环</span></a></h3><p><code>with_fileglob</code> 用于文件操作:</p><ul><li>匹配文件模式</li><li>批量处理文件</li><li>支持通配符</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 复制配置文件</span>
<span class="line">    <span class="token key atrule">copy</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">src</span><span class="token punctuation">:</span> <span class="token string">&quot;{{ item }}&quot;</span></span>
<span class="line">      <span class="token key atrule">dest</span><span class="token punctuation">:</span> /etc/app/</span>
<span class="line">    <span class="token key atrule">with_fileglob</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;files/*.conf&quot;</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;templates/*.j2&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="序列循环" tabindex="-1"><a class="header-anchor" href="#序列循环"><span>序列循环</span></a></h3><p><code>with_sequence</code> 生成数字序列:</p><ul><li>指定起始值</li><li>设置结束值</li><li>定义步长</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 创建多个目录</span>
<span class="line">    <span class="token key atrule">file</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/dir{{ item }}&quot;</span></span>
<span class="line">      <span class="token key atrule">state</span><span class="token punctuation">:</span> directory</span>
<span class="line">    <span class="token key atrule">with_sequence</span><span class="token punctuation">:</span> start=1 end=5 stride=1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="错误处理" tabindex="-1"><a class="header-anchor" href="#错误处理"><span>错误处理</span></a></h2><h3 id="忽略错误" tabindex="-1"><a class="header-anchor" href="#忽略错误"><span>忽略错误</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 尝试操作</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> /bin/false</span>
<span class="line">    <span class="token key atrule">ignore_errors</span><span class="token punctuation">:</span> yes</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="条件判断" tabindex="-1"><a class="header-anchor" href="#条件判断"><span>条件判断</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 检查服务状态</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> systemctl status httpd</span>
<span class="line">    <span class="token key atrule">register</span><span class="token punctuation">:</span> result</span>
<span class="line">    <span class="token key atrule">failed_when</span><span class="token punctuation">:</span> <span class="token string">&quot;&#39;active&#39; not in result.stdout&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="块错误处理" tabindex="-1"><a class="header-anchor" href="#块错误处理"><span>块错误处理</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">block</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装应用</span>
<span class="line">        <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=app state=present</span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 启动服务</span>
<span class="line">        <span class="token key atrule">service</span><span class="token punctuation">:</span> name=app state=started</span>
<span class="line">    <span class="token key atrule">rescue</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 清理安装</span>
<span class="line">        <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=app state=absent</span>
<span class="line">    <span class="token key atrule">always</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 通知管理员</span>
<span class="line">        <span class="token key atrule">mail</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">to</span><span class="token punctuation">:</span> admin@example.com</span>
<span class="line">          <span class="token key atrule">subject</span><span class="token punctuation">:</span> 部署状态</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="任务控制" tabindex="-1"><a class="header-anchor" href="#任务控制"><span>任务控制</span></a></h2><h3 id="标签-tags" tabindex="-1"><a class="header-anchor" href="#标签-tags"><span>标签(Tags)</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装包</span>
<span class="line">    <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=httpd state=present</span>
<span class="line">    <span class="token key atrule">tags</span><span class="token punctuation">:</span> install</span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 配置服务</span>
<span class="line">    <span class="token key atrule">template</span><span class="token punctuation">:</span> src=httpd.conf.j2 dest=/etc/httpd.conf</span>
<span class="line">    <span class="token key atrule">tags</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> config</span>
<span class="line">      <span class="token punctuation">-</span> httpd</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="任务委派" tabindex="-1"><a class="header-anchor" href="#任务委派"><span>任务委派</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 添加到负载均衡</span>
<span class="line">    <span class="token key atrule">shell</span><span class="token punctuation">:</span> /usr/local/bin/add_to_lb.sh <span class="token punctuation">{</span><span class="token punctuation">{</span> inventory_hostname <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token key atrule">delegate_to</span><span class="token punctuation">:</span> localhost</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="任务超时" tabindex="-1"><a class="header-anchor" href="#任务超时"><span>任务超时</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">tasks</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 长时间运行的任务</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> /usr/bin/long_running_operation</span>
<span class="line">    <span class="token key atrule">async</span><span class="token punctuation">:</span> <span class="token number">3600</span>  <span class="token comment"># 1小时超时</span></span>
<span class="line">    <span class="token key atrule">poll</span><span class="token punctuation">:</span> <span class="token number">0</span>      <span class="token comment"># 立即返回</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="最佳实践" tabindex="-1"><a class="header-anchor" href="#最佳实践"><span>最佳实践</span></a></h2><ol><li><p><strong>任务设计</strong></p><ul><li>保持任务幂等性</li><li>合理使用条件判断</li><li>适当处理错误</li></ul></li><li><p><strong>代码组织</strong></p><ul><li>使用有意义的标签</li><li>合理分组任务</li><li>注意执行顺序</li></ul></li><li><p><strong>错误处理</strong></p><ul><li>使用 block/rescue</li><li>设置合理超时</li><li>记录错误信息</li></ul></li></ol><blockquote><p><strong>注意：</strong></p><ul><li>避免过度复杂的条件</li><li>谨慎使用 ignore_errors</li><li>合理使用任务委派</li></ul></blockquote><hr><blockquote><p><strong>参考资料：</strong></p><ul><li><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_conditionals.html" target="_blank" rel="noopener noreferrer">Ansible 条件判断</a></li><li><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_loops.html" target="_blank" rel="noopener noreferrer">Ansible 循环指南</a></li><li><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_error_handling.html" target="_blank" rel="noopener noreferrer">Ansible 错误处理</a></li></ul></blockquote>`,49))])}const B=i(r,[["render",O],["__file","Playbook-2.html.vue"]]),D=JSON.parse('{"path":"/flinux/Ansible/Playbook-2.html","title":"Playbook: 操作","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"条件语句","slug":"条件语句","link":"#条件语句","children":[{"level":3,"title":"单一条件","slug":"单一条件","link":"#单一条件","children":[]},{"level":3,"title":"多重条件","slug":"多重条件","link":"#多重条件","children":[]},{"level":3,"title":"注册变量条件","slug":"注册变量条件","link":"#注册变量条件","children":[]},{"level":3,"title":"变量存在性检查","slug":"变量存在性检查","link":"#变量存在性检查","children":[]}]},{"level":2,"title":"循环语句","slug":"循环语句","link":"#循环语句","children":[{"level":3,"title":"基本循环","slug":"基本循环","link":"#基本循环","children":[]},{"level":3,"title":"字典循环","slug":"字典循环","link":"#字典循环","children":[]},{"level":3,"title":"文件匹配循环","slug":"文件匹配循环","link":"#文件匹配循环","children":[]},{"level":3,"title":"序列循环","slug":"序列循环","link":"#序列循环","children":[]}]},{"level":2,"title":"错误处理","slug":"错误处理","link":"#错误处理","children":[{"level":3,"title":"忽略错误","slug":"忽略错误","link":"#忽略错误","children":[]},{"level":3,"title":"条件判断","slug":"条件判断","link":"#条件判断","children":[]},{"level":3,"title":"块错误处理","slug":"块错误处理","link":"#块错误处理","children":[]}]},{"level":2,"title":"任务控制","slug":"任务控制","link":"#任务控制","children":[{"level":3,"title":"标签(Tags)","slug":"标签-tags","link":"#标签-tags","children":[]},{"level":3,"title":"任务委派","slug":"任务委派","link":"#任务委派","children":[]},{"level":3,"title":"任务超时","slug":"任务超时","link":"#任务超时","children":[]}]},{"level":2,"title":"最佳实践","slug":"最佳实践","link":"#最佳实践","children":[]}],"git":{"updatedTime":1701020615000,"contributors":[{"name":"Linkefou","username":"Linkefou","email":"wlh724567296@163.com","commits":1}]},"filePathRelative":"flinux/Ansible/Playbook-2.md"}');export{B as comp,D as data};
